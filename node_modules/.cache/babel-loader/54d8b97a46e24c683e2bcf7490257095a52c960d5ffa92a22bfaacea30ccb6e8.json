{"ast":null,"code":"// src/utils/moduleMasterApi.js\n\nconst web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\nconst WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n\n// function getCacheKey(module) {\n//   return `masterCache_${module}`;\n// }\n\nfunction getCacheKey(module, page) {\n  return `masterCache_${module}_page_${page}`;\n}\nconst TTL = 6 * 60 * 60 * 1000; // 6h\n\nfunction getCache(key) {\n  try {\n    const raw = sessionStorage.getItem(key);\n    if (!raw) return null;\n    const {\n      data,\n      timestamp\n    } = JSON.parse(raw);\n    if (Date.now() - timestamp < TTL) return data;\n  } catch {}\n  return null;\n}\n\n// Generic fetch helper\nasync function callBackend(action, module, payload = {}) {\n  const body = {\n    action,\n    module,\n    ...payload\n  };\n\n  //console.log(\"Calling backend:\", body, WEB_APP_URL);\n\n  const res = await fetch(WEB_APP_URL, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: {\n      'Content-Type': 'text/plain;charset=utf-8'\n    }\n  });\n  if (!res.ok) {\n    const errText = await res.text();\n    throw new Error(`Error ${action}: ${res.status} ${res.statusText} - ${errText}`);\n  }\n  return await res.json();\n}\n\n//Run in Console Logs, for any test any time\n// const web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\n// const WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n// fetch(WEB_APP_URL, {\n//   method: 'POST',\n//   redirect: 'follow',\n//   headers: {\n//     'Content-Type': 'text/plain;charset=utf-8'\n//   },\n//   body: JSON.stringify({ action: 'getMasterData',module:'product' })\n// })\n//   .then(res => res.json())\n//   .then(console.log)\n//   .catch(console.error);\n\nfunction setCache(key, data) {\n  sessionStorage.setItem(key, JSON.stringify({\n    data,\n    timestamp: Date.now()\n  }));\n}\n\n// Fetch master records\nexport async function fetchMasterData(module) {\n  const key = `dump_${module}`;\n  const cached = getCache(key);\n  if (cached) return cached;\n  const res = await callBackend('getMasterData', module);\n  setCache(key, res);\n  return res;\n}\n\n// export async function fetchMasterData(module, page = 1, force = false) {\n//   const cacheKey = getCacheKey(module, page);\n//   const cached = JSON.parse(sessionStorage.getItem(cacheKey));\n//   const expired = !cached || Date.now() - cached.timestamp > 3600000;\n\n//   if (!force && cached && !expired) \n//   {\n//     console.log(`[CACHE] Using cached data for ${module} page ${page}`);\n//     return cached.data;\n//   }\n\n//   const data = await callBackend('getMasterData', module, { page });\n//   sessionStorage.setItem(cacheKey, JSON.stringify({ data, timestamp: Date.now() }));\n//   return data;\n// }\n\n// Fetch dropdown values\nexport async function fetchDropdownOptions(module) {\n  return await callBackend('getDropdowns', module);\n}\n\n// Add new record\nexport async function addRecord(module, record, userId) {\n  const result = await callBackend('addRecord', module, {\n    data: record,\n    userId\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Edit existing record\nexport async function editRecord(module, record, userId) {\n  const result = await callBackend('editRecord', module, {\n    data: record,\n    userId\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Delete record by primaryKey\nexport async function deleteRecord(module, primaryKey) {\n  const result = await callBackend('deleteRecord', module, {\n    primaryKey\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\nexport { callBackend };","map":{"version":3,"names":["web_app_id","WEB_APP_URL","getCacheKey","module","page","TTL","getCache","key","raw","sessionStorage","getItem","data","timestamp","JSON","parse","Date","now","callBackend","action","payload","body","res","fetch","method","stringify","headers","ok","errText","text","Error","status","statusText","json","setCache","setItem","fetchMasterData","cached","fetchDropdownOptions","addRecord","record","userId","result","removeItem","editRecord","deleteRecord","primaryKey"],"sources":["/Users/abhilash/Downloads/jp-internal-app/src/utils/moduleMasterAPI.js"],"sourcesContent":["// src/utils/moduleMasterApi.js\n\nconst web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\nconst WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n\n// function getCacheKey(module) {\n//   return `masterCache_${module}`;\n// }\n\nfunction getCacheKey(module, page) {\n  return `masterCache_${module}_page_${page}`;\n}\n\nconst TTL = 6 * 60 * 60 * 1000; // 6h\n\nfunction getCache(key) {\n  try {\n    const raw = sessionStorage.getItem(key);\n    if (!raw) return null;\n    const { data, timestamp } = JSON.parse(raw);\n    if (Date.now() - timestamp < TTL) return data;\n  } catch {}\n  return null;\n}\n\n// Generic fetch helper\nasync function callBackend(action, module, payload = {}) {\n  const body = {\n    action,\n    module,\n    ...payload,\n  };\n\n  //console.log(\"Calling backend:\", body, WEB_APP_URL);\n\n  const res = await fetch(WEB_APP_URL, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: { 'Content-Type': 'text/plain;charset=utf-8' },\n  });\n\n  if (!res.ok) {\n    const errText = await res.text();\n    throw new Error(`Error ${action}: ${res.status} ${res.statusText} - ${errText}`);\n  }\n\n  return await res.json();\n}\n\n//Run in Console Logs, for any test any time\n// const web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\n// const WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n// fetch(WEB_APP_URL, {\n//   method: 'POST',\n//   redirect: 'follow',\n//   headers: {\n//     'Content-Type': 'text/plain;charset=utf-8'\n//   },\n//   body: JSON.stringify({ action: 'getMasterData',module:'product' })\n// })\n//   .then(res => res.json())\n//   .then(console.log)\n//   .catch(console.error);\n\nfunction setCache(key, data) {\n  sessionStorage.setItem(key, JSON.stringify({ data, timestamp: Date.now() }));\n}\n\n// Fetch master records\nexport async function fetchMasterData(module) {\n  const key = `dump_${module}`;\n  const cached = getCache(key);\n  if (cached) return cached;\n  const res = await callBackend('getMasterData',  module );\n  setCache(key, res);\n  return res;\n}\n\n// export async function fetchMasterData(module, page = 1, force = false) {\n//   const cacheKey = getCacheKey(module, page);\n//   const cached = JSON.parse(sessionStorage.getItem(cacheKey));\n//   const expired = !cached || Date.now() - cached.timestamp > 3600000;\n\n//   if (!force && cached && !expired) \n//   {\n//     console.log(`[CACHE] Using cached data for ${module} page ${page}`);\n//     return cached.data;\n//   }\n\n//   const data = await callBackend('getMasterData', module, { page });\n//   sessionStorage.setItem(cacheKey, JSON.stringify({ data, timestamp: Date.now() }));\n//   return data;\n// }\n\n// Fetch dropdown values\nexport async function fetchDropdownOptions(module) {\n  return await callBackend('getDropdowns', module);\n}\n\n// Add new record\nexport async function addRecord(module, record, userId) {\n  const result = await callBackend('addRecord', module, { data: record, userId });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Edit existing record\nexport async function editRecord(module, record, userId) {\n  const result = await callBackend('editRecord', module, { data: record, userId });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Delete record by primaryKey\nexport async function deleteRecord(module, primaryKey) {\n  const result = await callBackend('deleteRecord', module, { primaryKey });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\nexport { callBackend };\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}