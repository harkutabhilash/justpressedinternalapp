{"ast":null,"code":"// src/api/masterApi.js\n\nconst web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\nconst WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n\n// function getCacheKey(module) {\n//   return `masterCache_${module}`;\n// }\n\nfunction getCacheKey(module, page) {\n  return `masterCache_${module}_page_${page}`;\n}\n\n// Generic fetch helper\nasync function callBackend(action, module, payload = {}) {\n  const body = {\n    action,\n    module,\n    ...payload\n  };\n\n  //console.log(\"Calling backend:\", body, WEB_APP_URL);\n\n  const res = await fetch(WEB_APP_URL, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: {\n      'Content-Type': 'text/plain;charset=utf-8'\n    }\n  });\n  if (!res.ok) {\n    const errText = await res.text();\n    throw new Error(`Error ${action}: ${res.status} ${res.statusText} - ${errText}`);\n  }\n  return await res.json();\n}\n\n//Run in Console Logs, for any test any time\n// const web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\n// const WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n// fetch(WEB_APP_URL, {\n//   method: 'POST',\n//   redirect: 'follow',\n//   headers: {\n//     'Content-Type': 'text/plain;charset=utf-8'\n//   },\n//   body: JSON.stringify({ action: 'getMasterData',module:'product' })\n// })\n//   .then(res => res.json())\n//   .then(console.log)\n//   .catch(console.error);\n\nfunction setCache(key, data) {\n  sessionStorage.setItem(key, JSON.stringify({\n    data,\n    timestamp: Date.now()\n  }));\n}\n\n// Fetch master records\nexport async function fetchMasterDataDump(module) {\n  const key = `dump_${module}`;\n  const cached = getCache(key);\n  if (cached) return cached;\n  const res = await callBackend('getMasterData', {\n    module\n  });\n  setCache(key, res);\n  return res;\n}\n\n// export async function fetchMasterData(module, page = 1, force = false) {\n//   const cacheKey = getCacheKey(module, page);\n//   const cached = JSON.parse(sessionStorage.getItem(cacheKey));\n//   const expired = !cached || Date.now() - cached.timestamp > 3600000;\n\n//   if (!force && cached && !expired) \n//   {\n//     console.log(`[CACHE] Using cached data for ${module} page ${page}`);\n//     return cached.data;\n//   }\n\n//   const data = await callBackend('getMasterData', module, { page });\n//   sessionStorage.setItem(cacheKey, JSON.stringify({ data, timestamp: Date.now() }));\n//   return data;\n// }\n\n// Fetch dropdown values\nexport async function fetchDropdownOptions(module) {\n  return await callBackend('getDropdowns', module);\n}\n\n// Add new record\nexport async function addRecord(module, record, userId) {\n  const result = await callBackend('addRecord', module, {\n    data: record,\n    userId\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Edit existing record\nexport async function editRecord(module, record, userId) {\n  const result = await callBackend('editRecord', module, {\n    data: record,\n    userId\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Delete record by primaryKey\nexport async function deleteRecord(module, primaryKey) {\n  const result = await callBackend('deleteRecord', module, {\n    primaryKey\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}","map":{"version":3,"names":["web_app_id","WEB_APP_URL","getCacheKey","module","page","callBackend","action","payload","body","res","fetch","method","JSON","stringify","headers","ok","errText","text","Error","status","statusText","json","setCache","key","data","sessionStorage","setItem","timestamp","Date","now","fetchMasterDataDump","cached","getCache","fetchDropdownOptions","addRecord","record","userId","result","removeItem","editRecord","deleteRecord","primaryKey"],"sources":["/Users/abhilash/Downloads/jp-internal-app/src/utils/moduleMasterAPI.js"],"sourcesContent":["// src/api/masterApi.js\n\nconst web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\nconst WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n\n// function getCacheKey(module) {\n//   return `masterCache_${module}`;\n// }\n\nfunction getCacheKey(module, page) {\n  return `masterCache_${module}_page_${page}`;\n}\n\n// Generic fetch helper\nasync function callBackend(action, module, payload = {}) {\n  const body = {\n    action,\n    module,\n    ...payload,\n  };\n\n  //console.log(\"Calling backend:\", body, WEB_APP_URL);\n\n  const res = await fetch(WEB_APP_URL, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: { 'Content-Type': 'text/plain;charset=utf-8' },\n  });\n\n  if (!res.ok) {\n    const errText = await res.text();\n    throw new Error(`Error ${action}: ${res.status} ${res.statusText} - ${errText}`);\n  }\n\n  return await res.json();\n}\n\n//Run in Console Logs, for any test any time\n// const web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\n// const WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n// fetch(WEB_APP_URL, {\n//   method: 'POST',\n//   redirect: 'follow',\n//   headers: {\n//     'Content-Type': 'text/plain;charset=utf-8'\n//   },\n//   body: JSON.stringify({ action: 'getMasterData',module:'product' })\n// })\n//   .then(res => res.json())\n//   .then(console.log)\n//   .catch(console.error);\n\nfunction setCache(key, data) {\n  sessionStorage.setItem(key, JSON.stringify({ data, timestamp: Date.now() }));\n}\n\n// Fetch master records\nexport async function fetchMasterDataDump(module) {\n  const key = `dump_${module}`;\n  const cached = getCache(key);\n  if (cached) return cached;\n  const res = await callBackend('getMasterData', { module });\n  setCache(key, res);\n  return res;\n}\n\n// export async function fetchMasterData(module, page = 1, force = false) {\n//   const cacheKey = getCacheKey(module, page);\n//   const cached = JSON.parse(sessionStorage.getItem(cacheKey));\n//   const expired = !cached || Date.now() - cached.timestamp > 3600000;\n\n//   if (!force && cached && !expired) \n//   {\n//     console.log(`[CACHE] Using cached data for ${module} page ${page}`);\n//     return cached.data;\n//   }\n\n//   const data = await callBackend('getMasterData', module, { page });\n//   sessionStorage.setItem(cacheKey, JSON.stringify({ data, timestamp: Date.now() }));\n//   return data;\n// }\n\n// Fetch dropdown values\nexport async function fetchDropdownOptions(module) {\n  return await callBackend('getDropdowns', module);\n}\n\n// Add new record\nexport async function addRecord(module, record, userId) {\n  const result = await callBackend('addRecord', module, { data: record, userId });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Edit existing record\nexport async function editRecord(module, record, userId) {\n  const result = await callBackend('editRecord', module, { data: record, userId });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Delete record by primaryKey\nexport async function deleteRecord(module, primaryKey) {\n  const result = await callBackend('deleteRecord', module, { primaryKey });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}