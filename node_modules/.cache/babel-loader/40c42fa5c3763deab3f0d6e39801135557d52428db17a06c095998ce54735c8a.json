{"ast":null,"code":"// src/utils/dropdownProvider.js\nimport { fetchMasterData } from './moduleMasterAPI'; // NOTE: exact filename + casing!\n\nfunction getDump(module) {\n  const raw = sessionStorage.getItem(`dump_${module}`);\n  if (!raw) return null;\n  try {\n    const parsed = JSON.parse(raw);\n    // unwrap { data, timestamp } if present\n    return parsed && parsed.data ? parsed.data : parsed;\n  } catch {\n    return null;\n  }\n}\nexport async function getOptionsFromModuleSource(source) {\n  var _dump;\n  const [module, prop] = String(source).split('.');\n  console.debug('[dropdownProvider] called with source:', source, '→ module:', module, 'prop:', prop);\n  if (!module || !prop) {\n    console.warn('[dropdownProvider] Bad source:', source);\n    return [];\n  }\n\n  // 1) try cache\n  let dump = getDump(module);\n  console.debug('[dropdownProvider] cache hit?', !!dump);\n\n  // 2) fetch if not cached\n  if (!dump) {\n    console.debug('[dropdownProvider] fetching dump for module:', module);\n    dump = await fetchMasterData(module); // expected: { headers, rows, totalRecords }\n  }\n  const rows = Array.isArray((_dump = dump) === null || _dump === void 0 ? void 0 : _dump.rows) ? dump.rows : [];\n  if (rows.length === 0) return [];\n\n  // allow case-insensitive property resolution once\n  let resolvedKey = prop;\n  if (!(resolvedKey in rows[0])) {\n    const lower = prop.toLowerCase();\n    const match = Object.keys(rows[0]).find(k => k.toLowerCase() === lower);\n    if (match) resolvedKey = match;\n  }\n  const uniq = new Set();\n  for (const r of rows) {\n    const v = r === null || r === void 0 ? void 0 : r[resolvedKey];\n    if (v !== undefined && v !== null && `${v}`.trim() !== '') uniq.add(String(v));\n  }\n  const out = Array.from(uniq).sort((a, b) => a.localeCompare(b));\n  console.debug('[dropdownProvider] options built:', out.length, out.slice(0, 5));\n  return out;\n}","map":{"version":3,"names":["fetchMasterData","getDump","module","raw","sessionStorage","getItem","parsed","JSON","parse","data","getOptionsFromModuleSource","source","_dump","prop","String","split","console","debug","warn","dump","rows","Array","isArray","length","resolvedKey","lower","toLowerCase","match","Object","keys","find","k","uniq","Set","r","v","undefined","trim","add","out","from","sort","a","b","localeCompare","slice"],"sources":["/Users/abhilash/Downloads/jp-internal-app/src/utils/dropdownProvider.js"],"sourcesContent":["// src/utils/dropdownProvider.js\nimport { fetchMasterData } from './moduleMasterAPI'; // NOTE: exact filename + casing!\n\nfunction getDump(module) {\n  const raw = sessionStorage.getItem(`dump_${module}`);\n  if (!raw) return null;\n  try { const parsed = JSON.parse(raw);\n    // unwrap { data, timestamp } if present\n    return parsed && parsed.data ? parsed.data : parsed; } \n  catch { return null; }\n}\n\nexport async function getOptionsFromModuleSource(source) {\n  const [module, prop] = String(source).split('.');\n  console.debug('[dropdownProvider] called with source:', source, '→ module:', module, 'prop:', prop);\n\n  if (!module || !prop) {\n    console.warn('[dropdownProvider] Bad source:', source);\n    return [];\n  }\n\n  // 1) try cache\n  let dump = getDump(module);\n  console.debug('[dropdownProvider] cache hit?', !!dump);\n\n  // 2) fetch if not cached\n  if (!dump) {\n    console.debug('[dropdownProvider] fetching dump for module:', module);\n    dump = await fetchMasterData(module); // expected: { headers, rows, totalRecords }\n  }\n\n  const rows = Array.isArray(dump?.rows) ? dump.rows : [];\n  if (rows.length === 0) return [];\n\n  // allow case-insensitive property resolution once\n  let resolvedKey = prop;\n  if (!(resolvedKey in rows[0])) {\n    const lower = prop.toLowerCase();\n    const match = Object.keys(rows[0]).find(k => k.toLowerCase() === lower);\n    if (match) resolvedKey = match;\n  }\n\n  const uniq = new Set();\n  for (const r of rows) {\n    const v = r?.[resolvedKey];\n    if (v !== undefined && v !== null && `${v}`.trim() !== '') uniq.add(String(v));\n  }\n\n  const out = Array.from(uniq).sort((a, b) => a.localeCompare(b));\n  console.debug('[dropdownProvider] options built:', out.length, out.slice(0, 5));\n  return out;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}