{"ast":null,"code":"// src/utils/logFormAPI.js\nimport { callBackend, fetchAppModules } from './moduleStructureAPI';\nexport async function fetchLogFormConfig(module) {\n  var _appModulesCache, _appModulesCache$data, _matched$modules$find;\n  const cacheKey = `${module}_formConfigCache`;\n  const cached = JSON.parse(sessionStorage.getItem(cacheKey));\n  const cacheDuration = 6 * 60 * 60 * 1000;\n  if (cached && Date.now() - cached.timestamp < cacheDuration) return cached.data;\n\n  // ensure appModules in cache\n  let appModulesCache = JSON.parse(sessionStorage.getItem('appModulesCache'));\n  if (!appModulesCache || !appModulesCache.data) {\n    await fetchAppModules(true);\n    appModulesCache = JSON.parse(sessionStorage.getItem('appModulesCache'));\n  }\n  const matched = (_appModulesCache = appModulesCache) === null || _appModulesCache === void 0 ? void 0 : (_appModulesCache$data = _appModulesCache.data) === null || _appModulesCache$data === void 0 ? void 0 : _appModulesCache$data.find(g => g.modules.some(m => m.module === module));\n  const sheetId = matched === null || matched === void 0 ? void 0 : (_matched$modules$find = matched.modules.find(m => m.module === module)) === null || _matched$modules$find === void 0 ? void 0 : _matched$modules$find.sheetId;\n  if (!sheetId) throw new Error(`No sheetId found for ${module}`);\n\n  // --- fetch config & dropdowns\n  const cfg = await callBackend('getSheetData', {\n    sheetId,\n    tab: 'config'\n  });\n  const dds = await callBackend('getSheetData', {\n    sheetId,\n    tab: 'dropdowns'\n  });\n\n  // ---- normalize config -> array of field objects (unchanged) ----\n  const headers = (cfg === null || cfg === void 0 ? void 0 : cfg.headers) || [];\n  const rows = (cfg === null || cfg === void 0 ? void 0 : cfg.rows) || [];\n  const toBool = v => String(v).toLowerCase() === 'true';\n  const n = v => v === '' || v == null ? undefined : Number(v);\n  const fields = rows.map(r => {\n    var _n, _n2;\n    const obj = {};\n    headers.forEach((h, i) => {\n      var _ref, _r$h;\n      obj[h] = (_ref = (_r$h = r[h]) !== null && _r$h !== void 0 ? _r$h : r[i]) !== null && _ref !== void 0 ? _ref : r[headers[i]];\n    });\n    obj.showInApp = toBool(obj.showInApp);\n    obj.isRequired = String(obj.isRequired).toLowerCase() === 'true';\n    obj.formRow = (_n = n(obj.formRow)) !== null && _n !== void 0 ? _n : 0;\n    obj.formColumn = (_n2 = n(obj.formColumn)) !== null && _n2 !== void 0 ? _n2 : 0;\n    const dt = String(obj.dataType || '').toLowerCase();\n    if (/^float|^number/.test(dt)) {\n      obj.dataType = 'number';\n      obj.inputType = obj.inputType || 'number';\n    }\n    if (String(obj.inputType).toLowerCase() === 'date') obj.dataType = 'date';\n    return obj;\n  }).filter(f => f.showInApp && f.key);\n\n  // ---- normalize dropdowns (support both shapes) ----\n  let dropdowns = {};\n\n  // Case A: BE already returns a map { key: string[] }\n  if (dds && typeof dds === 'object' && !Array.isArray(dds.rows)) {\n    Object.entries(dds).forEach(([k, arr]) => {\n      const vals = Array.isArray(arr) ? arr : [];\n      dropdowns[k] = Array.from(new Set(vals.map(v => String(v).trim()).filter(Boolean))).sort((a, b) => a.localeCompare(b));\n    });\n    // Case B: Legacy shape { headers, rows } or [{...}, ...]\n  } else {\n    const ddRows = Array.isArray(dds === null || dds === void 0 ? void 0 : dds.rows) && dds.rows || (Array.isArray(dds) ? dds : []);\n    const temp = {};\n    ddRows.forEach(row => {\n      Object.entries(row).forEach(([k, v]) => {\n        const s = String(v !== null && v !== void 0 ? v : '').trim();\n        if (s) (temp[k] ||= new Set()).add(s);\n      });\n    });\n    Object.keys(temp).forEach(k => {\n      dropdowns[k] = Array.from(temp[k]).sort((a, b) => a.localeCompare(b));\n    });\n  }\n  const finalData = {\n    fields,\n    dropdowns,\n    sheetId\n  };\n  sessionStorage.setItem(`${module}_formConfigCache`, JSON.stringify({\n    data: finalData,\n    timestamp: Date.now()\n  }));\n  return finalData;\n}\n\n// helpers\nfunction normalizeFieldRow(obj) {\n  const toBool = v => String(v).toLowerCase() === 'true';\n  const numOr0 = v => v === '' || v == null ? 0 : Number(v);\n  const out = {\n    ...obj\n  };\n  out.showInApp = toBool(out.showInApp);\n  out.isRequired = toBool(out.isRequired);\n  out.formRow = numOr0(out.formRow);\n  out.formColumn = numOr0(out.formColumn);\n  const dt = String(out.dataType || '').toLowerCase();\n  if (/^float|^number/.test(dt)) {\n    out.dataType = 'number';\n    out.inputType = out.inputType || 'number';\n  }\n  if (String(out.inputType).toLowerCase() === 'date') {\n    out.dataType = 'date';\n  }\n  return out;\n}","map":{"version":3,"names":["callBackend","fetchAppModules","fetchLogFormConfig","module","_appModulesCache","_appModulesCache$data","_matched$modules$find","cacheKey","cached","JSON","parse","sessionStorage","getItem","cacheDuration","Date","now","timestamp","data","appModulesCache","matched","find","g","modules","some","m","sheetId","Error","cfg","tab","dds","headers","rows","toBool","v","String","toLowerCase","n","undefined","Number","fields","map","r","_n","_n2","obj","forEach","h","i","_ref","_r$h","showInApp","isRequired","formRow","formColumn","dt","dataType","test","inputType","filter","f","key","dropdowns","Array","isArray","Object","entries","k","arr","vals","from","Set","trim","Boolean","sort","a","b","localeCompare","ddRows","temp","row","s","add","keys","finalData","setItem","stringify","normalizeFieldRow","numOr0","out"],"sources":["/Users/abhilash/Downloads/jp-internal-app/src/utils/logFormAPI.js"],"sourcesContent":["// src/utils/logFormAPI.js\nimport { callBackend, fetchAppModules } from './moduleStructureAPI';\n\nexport async function fetchLogFormConfig(module) {\n  const cacheKey = `${module}_formConfigCache`;\n  const cached = JSON.parse(sessionStorage.getItem(cacheKey));\n  const cacheDuration = 6 * 60 * 60 * 1000;\n  if (cached && Date.now() - cached.timestamp < cacheDuration) return cached.data;\n\n  // ensure appModules in cache\n  let appModulesCache = JSON.parse(sessionStorage.getItem('appModulesCache'));\n  if (!appModulesCache || !appModulesCache.data) {\n    await fetchAppModules(true);\n    appModulesCache = JSON.parse(sessionStorage.getItem('appModulesCache'));\n  }\n\n  const matched = appModulesCache?.data?.find(g => g.modules.some(m => m.module === module));\n  const sheetId  = matched?.modules.find(m => m.module === module)?.sheetId;\n  if (!sheetId) throw new Error(`No sheetId found for ${module}`);\n\n  // --- fetch config & dropdowns\n  const cfg = await callBackend('getSheetData', { sheetId, tab: 'config' });\n  const dds = await callBackend('getSheetData', { sheetId, tab: 'dropdowns' });\n\n// ---- normalize config -> array of field objects (unchanged) ----\nconst headers = (cfg?.headers || []);\nconst rows    = (cfg?.rows || []);\nconst toBool  = (v) => String(v).toLowerCase() === 'true';\nconst n       = (v) => (v === '' || v == null ? undefined : Number(v));\n\nconst fields = rows.map(r => {\n  const obj = {};\n  headers.forEach((h, i) => { obj[h] = r[h] ?? r[i] ?? r[headers[i]]; });\n  obj.showInApp   = toBool(obj.showInApp);\n  obj.isRequired  = String(obj.isRequired).toLowerCase() === 'true';\n  obj.formRow     = n(obj.formRow) ?? 0;\n  obj.formColumn  = n(obj.formColumn) ?? 0;\n\n  const dt = String(obj.dataType || '').toLowerCase();\n  if (/^float|^number/.test(dt)) {\n    obj.dataType  = 'number';\n    obj.inputType = obj.inputType || 'number';\n  }\n  if (String(obj.inputType).toLowerCase() === 'date') obj.dataType = 'date';\n  return obj;\n}).filter(f => f.showInApp && f.key);\n\n// ---- normalize dropdowns (support both shapes) ----\nlet dropdowns = {};\n\n// Case A: BE already returns a map { key: string[] }\nif (dds && typeof dds === 'object' && !Array.isArray(dds.rows)) {\n  Object.entries(dds).forEach(([k, arr]) => {\n    const vals = Array.isArray(arr) ? arr : [];\n    dropdowns[k] = Array.from(new Set(vals.map(v => String(v).trim()).filter(Boolean)))\n      .sort((a, b) => a.localeCompare(b));\n  });\n// Case B: Legacy shape { headers, rows } or [{...}, ...]\n} else {\n  const ddRows =\n    (Array.isArray(dds?.rows) && dds.rows) ||\n    (Array.isArray(dds) ? dds : []);\n  const temp = {};\n  ddRows.forEach(row => {\n    Object.entries(row).forEach(([k, v]) => {\n      const s = String(v ?? '').trim();\n      if (s) (temp[k] ||= new Set()).add(s);\n    });\n  });\n  Object.keys(temp).forEach(k => {\n    dropdowns[k] = Array.from(temp[k]).sort((a, b) => a.localeCompare(b));\n  });\n}\n\nconst finalData = { fields, dropdowns, sheetId };\nsessionStorage.setItem(\n  `${module}_formConfigCache`,\n  JSON.stringify({ data: finalData, timestamp: Date.now() })\n);\nreturn finalData;\n}\n\n// helpers\nfunction normalizeFieldRow(obj) {\n  const toBool = (v) => String(v).toLowerCase() === 'true';\n  const numOr0 = (v) => (v === '' || v == null ? 0 : Number(v));\n\n  const out = { ...obj };\n  out.showInApp  = toBool(out.showInApp);\n  out.isRequired = toBool(out.isRequired);\n  out.formRow    = numOr0(out.formRow);\n  out.formColumn = numOr0(out.formColumn);\n\n  const dt = String(out.dataType || '').toLowerCase();\n  if (/^float|^number/.test(dt)) {\n    out.dataType  = 'number';\n    out.inputType = out.inputType || 'number';\n  }\n  if (String(out.inputType).toLowerCase() === 'date') {\n    out.dataType = 'date';\n  }\n  return out;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}