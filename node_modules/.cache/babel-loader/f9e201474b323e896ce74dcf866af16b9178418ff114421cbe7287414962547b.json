{"ast":null,"code":"// src/api/masterApi.js\n\nconst web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\nconst WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n\n// function getCacheKey(module) {\n//   return `masterCache_${module}`;\n// }\n\nfunction getCacheKey(module, page) {\n  return `masterCache_${module}_page_${page}`;\n}\n\n// Generic fetch helper\nasync function callBackend(action, module, payload = {}) {\n  const body = {\n    action,\n    module,\n    ...payload\n  };\n\n  //console.log(\"Calling backend:\", body, WEB_APP_URL);\n\n  const res = await fetch(WEB_APP_URL, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: {\n      'Content-Type': 'text/plain;charset=utf-8'\n    }\n  });\n  if (!res.ok) {\n    const errText = await res.text();\n    throw new Error(`Error ${action}: ${res.status} ${res.statusText} - ${errText}`);\n  }\n  return await res.json();\n}\n\n//Run in Console Logs, for any test any time\n// const web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\n// const WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n// fetch(WEB_APP_URL, {\n//   method: 'POST',\n//   redirect: 'follow',\n//   headers: {\n//     'Content-Type': 'text/plain;charset=utf-8'\n//   },\n//   body: JSON.stringify({ action: 'getMasterData',module:'product' })\n// })\n//   .then(res => res.json())\n//   .then(console.log)\n//   .catch(console.error);\n\n// Fetch master records\n\nexport async function fetchMasterDataDump(module) {\n  const key = `dump_${module}`;\n  const cached = getCache(key);\n  if (cached) return cached;\n  const res = await callBackend('getMasterData', {\n    module\n  });\n  setCache(key, res);\n  return res;\n}\n\n// Fetch dropdown values\nexport async function fetchDropdownOptions(module) {\n  return await callBackend('getDropdowns', module);\n}\n\n// Add new record\nexport async function addRecord(module, record, userId) {\n  const result = await callBackend('addRecord', module, {\n    data: record,\n    userId\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Edit existing record\nexport async function editRecord(module, record, userId) {\n  const result = await callBackend('editRecord', module, {\n    data: record,\n    userId\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Delete record by primaryKey\nexport async function deleteRecord(module, primaryKey) {\n  const result = await callBackend('deleteRecord', module, {\n    primaryKey\n  });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}","map":{"version":3,"names":["web_app_id","WEB_APP_URL","getCacheKey","module","page","callBackend","action","payload","body","res","fetch","method","JSON","stringify","headers","ok","errText","text","Error","status","statusText","json","fetchMasterDataDump","key","cached","getCache","setCache","fetchDropdownOptions","addRecord","record","userId","result","data","sessionStorage","removeItem","editRecord","deleteRecord","primaryKey"],"sources":["/Users/abhilash/Downloads/jp-internal-app/src/utils/moduleMasterAPI.js"],"sourcesContent":["// src/api/masterApi.js\n\nconst web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\nconst WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n\n// function getCacheKey(module) {\n//   return `masterCache_${module}`;\n// }\n\nfunction getCacheKey(module, page) {\n  return `masterCache_${module}_page_${page}`;\n}\n\n// Generic fetch helper\nasync function callBackend(action, module, payload = {}) {\n  const body = {\n    action,\n    module,\n    ...payload,\n  };\n\n  //console.log(\"Calling backend:\", body, WEB_APP_URL);\n\n  const res = await fetch(WEB_APP_URL, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: { 'Content-Type': 'text/plain;charset=utf-8' },\n  });\n\n  if (!res.ok) {\n    const errText = await res.text();\n    throw new Error(`Error ${action}: ${res.status} ${res.statusText} - ${errText}`);\n  }\n\n  return await res.json();\n}\n\n//Run in Console Logs, for any test any time\n// const web_app_id = \"AKfycbw6hmM3eAXn36NgrHdfpQ33o6iWeldK3GAPATueQ_GdwFThrBKAV2PdGr_iJBNwWUCUdw\";\n// const WEB_APP_URL = `https://script.google.com/macros/s/${web_app_id}/exec`;\n// fetch(WEB_APP_URL, {\n//   method: 'POST',\n//   redirect: 'follow',\n//   headers: {\n//     'Content-Type': 'text/plain;charset=utf-8'\n//   },\n//   body: JSON.stringify({ action: 'getMasterData',module:'product' })\n// })\n//   .then(res => res.json())\n//   .then(console.log)\n//   .catch(console.error);\n\n// Fetch master records\n\nexport async function fetchMasterDataDump(module) {\n  const key = `dump_${module}`;\n  const cached = getCache(key);\n  if (cached) return cached;\n  const res = await callBackend('getMasterData', { module });\n  setCache(key, res);\n  return res;\n}\n\n// Fetch dropdown values\nexport async function fetchDropdownOptions(module) {\n  return await callBackend('getDropdowns', module);\n}\n\n// Add new record\nexport async function addRecord(module, record, userId) {\n  const result = await callBackend('addRecord', module, { data: record, userId });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Edit existing record\nexport async function editRecord(module, record, userId) {\n  const result = await callBackend('editRecord', module, { data: record, userId });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n// Delete record by primaryKey\nexport async function deleteRecord(module, primaryKey) {\n  const result = await callBackend('deleteRecord', module, { primaryKey });\n  sessionStorage.removeItem(getCacheKey(module)); // invalidate cache\n  return result;\n}\n\n"],"mappings":"AAAA;;AAEA,MAAMA,UAAU,GAAG,4EAA4E;AAC/F,MAAMC,WAAW,GAAG,sCAAsCD,UAAU,OAAO;;AAE3E;AACA;AACA;;AAEA,SAASE,WAAWA,CAACC,MAAM,EAAEC,IAAI,EAAE;EACjC,OAAO,eAAeD,MAAM,SAASC,IAAI,EAAE;AAC7C;;AAEA;AACA,eAAeC,WAAWA,CAACC,MAAM,EAAEH,MAAM,EAAEI,OAAO,GAAG,CAAC,CAAC,EAAE;EACvD,MAAMC,IAAI,GAAG;IACXF,MAAM;IACNH,MAAM;IACN,GAAGI;EACL,CAAC;;EAED;;EAEA,MAAME,GAAG,GAAG,MAAMC,KAAK,CAACT,WAAW,EAAE;IACnCU,MAAM,EAAE,MAAM;IACdH,IAAI,EAAEI,IAAI,CAACC,SAAS,CAACL,IAAI,CAAC;IAC1BM,OAAO,EAAE;MAAE,cAAc,EAAE;IAA2B;EACxD,CAAC,CAAC;EAEF,IAAI,CAACL,GAAG,CAACM,EAAE,EAAE;IACX,MAAMC,OAAO,GAAG,MAAMP,GAAG,CAACQ,IAAI,CAAC,CAAC;IAChC,MAAM,IAAIC,KAAK,CAAC,SAASZ,MAAM,KAAKG,GAAG,CAACU,MAAM,IAAIV,GAAG,CAACW,UAAU,MAAMJ,OAAO,EAAE,CAAC;EAClF;EAEA,OAAO,MAAMP,GAAG,CAACY,IAAI,CAAC,CAAC;AACzB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,OAAO,eAAeC,mBAAmBA,CAACnB,MAAM,EAAE;EAChD,MAAMoB,GAAG,GAAG,QAAQpB,MAAM,EAAE;EAC5B,MAAMqB,MAAM,GAAGC,QAAQ,CAACF,GAAG,CAAC;EAC5B,IAAIC,MAAM,EAAE,OAAOA,MAAM;EACzB,MAAMf,GAAG,GAAG,MAAMJ,WAAW,CAAC,eAAe,EAAE;IAAEF;EAAO,CAAC,CAAC;EAC1DuB,QAAQ,CAACH,GAAG,EAAEd,GAAG,CAAC;EAClB,OAAOA,GAAG;AACZ;;AAEA;AACA,OAAO,eAAekB,oBAAoBA,CAACxB,MAAM,EAAE;EACjD,OAAO,MAAME,WAAW,CAAC,cAAc,EAAEF,MAAM,CAAC;AAClD;;AAEA;AACA,OAAO,eAAeyB,SAASA,CAACzB,MAAM,EAAE0B,MAAM,EAAEC,MAAM,EAAE;EACtD,MAAMC,MAAM,GAAG,MAAM1B,WAAW,CAAC,WAAW,EAAEF,MAAM,EAAE;IAAE6B,IAAI,EAAEH,MAAM;IAAEC;EAAO,CAAC,CAAC;EAC/EG,cAAc,CAACC,UAAU,CAAChC,WAAW,CAACC,MAAM,CAAC,CAAC,CAAC,CAAC;EAChD,OAAO4B,MAAM;AACf;;AAEA;AACA,OAAO,eAAeI,UAAUA,CAAChC,MAAM,EAAE0B,MAAM,EAAEC,MAAM,EAAE;EACvD,MAAMC,MAAM,GAAG,MAAM1B,WAAW,CAAC,YAAY,EAAEF,MAAM,EAAE;IAAE6B,IAAI,EAAEH,MAAM;IAAEC;EAAO,CAAC,CAAC;EAChFG,cAAc,CAACC,UAAU,CAAChC,WAAW,CAACC,MAAM,CAAC,CAAC,CAAC,CAAC;EAChD,OAAO4B,MAAM;AACf;;AAEA;AACA,OAAO,eAAeK,YAAYA,CAACjC,MAAM,EAAEkC,UAAU,EAAE;EACrD,MAAMN,MAAM,GAAG,MAAM1B,WAAW,CAAC,cAAc,EAAEF,MAAM,EAAE;IAAEkC;EAAW,CAAC,CAAC;EACxEJ,cAAc,CAACC,UAAU,CAAChC,WAAW,CAACC,MAAM,CAAC,CAAC,CAAC,CAAC;EAChD,OAAO4B,MAAM;AACf","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}